<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>地圖導航</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    .info { margin: 20px 0; font-size: 18px; }
    #map-container { width: 100%; height: 400px; border-radius: 8px; overflow: hidden; }
  </style>
  <!-- 高德地图JS API -->
  <script type="text/javascript">
    window.AMapSecurityConfig = {
      securityJsCode: "063dde410af943deb53618d6e8c9c65c"
    };
  </script>
  <script src="https://webapi.amap.com/maps?v=2.0&key=063dde410af943deb53618d6e8c9c65c"></script>
</head>
<body>
  <div class="info">
    {% if next_course %}
      <div>课程名称：{{ next_course.course }}</div>
      <div>课程时间：{{ next_course.time }}</div>
      <div>上课地点：{{ next_course.location }}</div>
      <div>距离上课还有：{{ next_course.minutes_left }} 分钟</div>
    {% else %}
      <div>今天没有即将开始的课程</div>
    {% endif %}
  </div>
  <div id="map-container"></div>
  {% if next_course %}
  <script>
    var map = new AMap.Map('map-container', {
      zoom: 16,
      center: [116.397428, 39.90923]
    });
    // 地点搜索并导航
    AMap.plugin(['AMap.PlaceSearch'], function() {
      var placeSearch = new AMap.PlaceSearch({
        city: '全国',
        map: map
      });
      // 搜索楼名
      placeSearch.search('{{ next_course.location }}', function(status, result) {
        if (status === 'complete' && result.poiList.pois.length > 0) {
          var poi = result.poiList.pois[0];
          map.setCenter(poi.location);
          new AMap.Marker({
            position: poi.location,
            map: map,
            title: '{{ next_course.location }}'
          });
        }
      });
    });
  </script>
  {% else %}
  <script>
    var map = new AMap.Map('map-container', {
      zoom: 16,
      center: [116.397428, 39.90923]
    });
    // 没有课程时，显示当前位置
    AMap.plugin('AMap.Geolocation', function() {
      var geolocation = new AMap.Geolocation({
        enableHighAccuracy: true,
        timeout: 10000,
        buttonPosition: 'RB',
        zoomToAccuracy: true
      });
      map.addControl(geolocation);
      geolocation.getCurrentPosition(function(status, result) {
        if (status === 'complete') {
          map.setCenter(result.position);
          new AMap.Marker({
            position: result.position,
            map: map,
            title: '当前位置'
          });
        }
      });
    });
  </script>
  {% endif %}
</body>
</html> 